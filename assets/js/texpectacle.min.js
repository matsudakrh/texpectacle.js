
/*!

  texpectacle.js
  
  Copyright (c) 2016 Hiroki Matsuda
  
  This software is released under the MIT License  http://opensource.org/licenses/mit-license.php

*/
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),Texpectacle_Class=function(){function e(t,i,n){_classCallCheck(this,e),this.element=t,this.idName=this.element.id,this.getClassName(),this.getSize(),this.text=t.textContent,t.textContent="",this.insertText(),this.length=this.text.length,this.baseDuration=i,this.setDuration(),this.offsetTop=parseInt(n)/100}return _createClass(e,[{key:"getClassName",value:function(){this.className=this.element.getAttribute("data-text-animation")||"fadeIn"}},{key:"setDuration",value:function(){var e=document.createElement("span");e.className=this.className,this.element.appendChild(e),this.getAnimationProperty(e),this.element.removeChild(e);var t=this.baseDuration-this.animationDuration;this.duration=t/this.length*1e3,this.duration=Math.round(this.duration-this.duration/this.length)}},{key:"getSize",value:function(){this.size=this.element.getBoundingClientRect()}},{key:"judge",value:function(){this.size.top<=window.innerHeight*this.offsetTop&&this.size.top>=0&&this.animation()}},{key:"getAnimationProperty",value:function(e){var t=window.getComputedStyle(e),i=t.animationDelay||t.webkitAnimationDelay,n=t.animationDuration||t.webkitAnimationDuration;this.animationDelay=parseFloat(i),this.animationDuration=parseFloat(n)}},{key:"insertText",value:function(){var e=this;this.element.innerHTML="";var t=document.createDocumentFragment(),i=document.createElement("span");[].forEach.call(this.text,function(n){var a=i.cloneNode();a.innerHTML=e.escapeHTML(n),a.style.visibility="hidden",a.style.display="inline-block",a.setAttribute("data-content",a.textContent),a.addEventListener("animationend",function(){a=null}),t.appendChild(a)}),this.element.appendChild(t)}},{key:"animation",value:function(){var e=this;if(window.removeEventListener("resize",this.resizeFuncName),window.removeEventListener("scroll",this.scrollFuncName),this.endTimer&&clearTimeout(this.endTimer),this.addClassTimer&&clearTimeout(this.addClassTimer),this.getClassName(),this.insertText(),this.targetIndex=0,this.setDuration(),this.duration<=this.animationDelay+this.animationDuration)return this.element.childNodes.forEach(function(t){t.style.visibility="visible",t.className=e.className}),void("function"==typeof this.endCallback&&(this.endTimer=setTimeout(function(){e.endCallback()},1e3*(this.animationDelay+this.animationDuration))));var t=function i(){var t=e.element.childNodes[e.targetIndex];return t.style.visibility="visible",t.className=e.className,e.targetIndex++,e.targetIndex>=e.length?void("function"==typeof e.endCallback&&(e.getAnimationProperty(t),e.endTimer=setTimeout(function(){e.endCallback()},1e3*(e.animationDelay+e.animationDuration)))):void(e.addClassTimer=setTimeout(function(){i()},e.duration))};this.animationTimer&&clearTimeout(this.animationTimer),this.animationTimer=setTimeout(function(){t(),"function"==typeof e.startCallback&&e.startCallback()},this.duration)}},{key:"setScroll",value:function(){var e=this;this.insertText();var t=!1,i=!1;this.resizeFuncName=this.idName+"-resize"+Date.now(),this.scrollFuncName=this.idName+"-scroll"+Date.now(),window.addEventListener("resize",this.resizeFuncName=function(){t&&clearTimeout(t),t=setTimeout(function(){e.judge()},200)}),window.addEventListener("scroll",this.scrollFuncName=function(){i&&clearTimeout(i),i=setTimeout(function(){e.getSize(),e.judge()},40)}),this.judge()}},{key:"escapeHTML",value:function(e){return e=e.replace(/&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/"/g,"&quot;"),e=e.replace(/'/g,"&#39;"),e=e.replace(/ /g,"&nbsp;"),e=e.replace(/ã€€/g,"&emsp;")}}]),e}(),texpectacle=function(e){var t=arguments.length<=1||void 0===arguments[1]?2:arguments[1],i=arguments.length<=2||void 0===arguments[2]?90:arguments[2],n=parseInt(i);return n<20?n=20:n>100?n=100:n||(n=90),isNaN(t)&&(t=2),new Texpectacle_Class(e,t,n)};"undefined"!=typeof module&&(module.exports=texpectacle);